\documentclass{article}

\usepackage[final]{style}
\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{verbatim}
\usepackage{graphicx}       % for figures

\title{Lecture \#6: Reconstrução 3D: Formas a partir de sombra, estéreo, textura e foco. Detecção de profundidade usando sensores ativos. Representação de superfícies e reconstrução baseada em modelos.}

\author{
  Felipe Torres Minorelli, Kevin Perondi Regis, Renan Viana Hoshi \\
  Department of Computer Science\\
  Federal University of Technology - Paran\'{a} / UTFPR\\
  Campo Mour\~{a}o, Paran\'{a}, Brazil \\
  \texttt{\{felipeminorelli,kevinperondi,renanvianah\}@gmail.com} \\
}

\begin{document}

\maketitle


\section{Introdução}

bla bla bla

\section{Formas a partir de sombra, estéreo, textura e foco}

Neste capítulo realizaremos o estudo de como formas podem ser inferidas a partir do sombreamento, textura e foco. Assim como estas 3 instâncias podem ser utilizadas para a reconstrução da geometria de um objeto 3D.

\subsection{Formas a partir de sombra}

Ao se observar um objeto sombreado, podemos distinguir sua forma apenas com a variação de sombreamento. Tal fenômeno ocorre pois a superfície normal do objeto muda ao longo de seu exterior, desta forma temos uma variação do brilho já que o mesmo é decorrente entre a variação da orientação da superfície e o ângulo da iluminação incidente. Podemos observar estas mudanças na Figura~\ref{fig:sombra}.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.90\textwidth]{imagem1.jpg}
    \caption{Forma sintética a partir de sombreamento (Zhang, Tsai, Cryer et al. 1999)}
    \label{fig:sombra}
\end{figure}

A recuperação da forma de uma superfície a partir desta variação é conhecida como \textit{shape from shading}, é um problema recorrente em visão computacional.
A maioria dos algoritmos de sombreamento assumem que o coeficiente de reflexão seja uniforme, e as direções da fonte de luz sejam conhecidas ou passiveis de alterações pelo uso de um objeto de referencia. A partir das suposições de observador e fontes de luz distantes, a variação de intensidade (equação de irradiância, Figura \ref{eq:irrad}) é baseada na orientação da superfície, onde (p,q) = (zx,zy) são as derivadas do mapa de profundidade e R(p,q) é o chamado mapa de reflectância.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.60\textwidth]{equacao1.jpg}
    \caption{Equação de irradiância}
    \label{eq:irrad}
\end{figure}

Por exemplo uma superfície difusa, tem um mapa de reflectância calculado através do produto entre um ponto não negativo e a superfície normal e a direção da fonte de luz, Figura \ref{eq:mapareflec}, onde \textit{p} é é o fator de reflectância da superfície.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.60\textwidth]{equacao2.jpg}
    \caption{Equação do mapa de reflectância}
    \label{eq:mapareflec}
\end{figure}

Teoricamente as equações \ref{eq:irrad} e \ref{eq:mapareflec} podem ser utilizadas para se estimar (p,q), porém,  a não ser que outras restrições sejam adicionadas, ainda temos mais pares desconhecidos (p,q) do que intensidades calculadas (I). Uma das restrições mais utilizadas é a restrição de suavidade, Figura~\ref{eq:suavidade}. A outra é a restrição de integrabilidade, Figura~\ref{eq:integrabilidade}, onde para uma mapa de profundidade válido temos \textit{z(x,y)} com \textit{(p,q) = (zx,zy)}, portanto \textit{py = zxy = zyx = qx}.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.60\textwidth]{equacao3.jpg}
    \caption{Restrição de suavidade}
    \label{eq:suavidade}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.60\textwidth]{equacao4.jpg}
    \caption{Restrição de integrabilidade}
    \label{eq:integrabilidade}
\end{figure}

Em vez de primeiro recuperar os campos de orientação \textit{(p, q)} e integrá-los para obter um
superfície, também é possível minimizar diretamente a discrepância na equação de formação de imagem
\ref{eq:irrad} ao encontrar o mapa de profundidade ideal \textit{z (x, y)}. Infelizmente, a forma
a partir do sombreamento é suscetível aos mínimos locais no espaço de busca, e como outros
problemas que envolvem a estimativa simultânea de muitas variáveis, também podem sofrer uma lenta convergência. Para diminuir este problema podemos nos utilizar de técnicas como a de multi-resolução (Szeliski 1991a) para acelerar a convergência, e as técnicas de otimização mais sofisticadas (Dupuis and Oliensis 1994), para a evitar mínimos locais.

Na prática, superfícies diferentes de modelos de gesso raramente possuem um coeficiente de reflectância uniforme. Portanto a reconstrução de forma a partir de sombreamento precisa ser combinado com alguma outra técnica ou estendido de alguma maneira para ter alguma utilidade. Uma maneira de fazer isso é a combinação com a correspondência estéreo (Fua e Leclerc 1995) ou textura conhecida (padrões de superfície) (White e Forsyth 2006), técnicas abordadas nas próximas seções. O estéreo e as componentes de textura fornecem informações em regiões texturizadas, enquanto a forma a partir de sombreamento ajuda preencha as informações em regiões uniformemente coloridas e também fornece informações mais detalhadas sobre a forma da superfície.

\subsection{Formas a partir do estéreo fotométrico}


Outra maneira de tornar a forma a partir do sombreamento mais confiável é utilização de várias
fontes de luz, que podem ser ativadas e desativadas seletivamente. Essa técnica é chamada de estéreo fotométrico. Uma vez que as fontes de luz desempenham um papel análogo às câmeras localizadas em diferentes locais, para cada fonte de luz, temos um mapa de refletância, \textit{R1 (p, q)}, \textit{R2 (p, q)}, etc, assim como as intensidades correspondentes \textit{I1}, \textit{I2}, etc. Em um pixel, podemos, em princípio, recuperar um coeficiente de reflectância desconhecido \textit{p} e uma orientação de superfície estimada \textit{(p, q)}. Para superfícies difusas (equação \ref{eq:mapareflec}), se parametrizarmos a orientação local por  \textit{nˆ}, obtemos (por pixeis não-sombreados) um conjunto de equações lineares da seguinte forma:

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.3\textwidth]{equacao5.jpg}
    \label{eq:estereo}
\end{figure}

A partir do qual podemos recuperar \textit{pnˆ} usando mínimos quadrados lineares. Essas equações estão bem condicionadas desde que os vetores (três ou mais) \textit{vk} sejam linearmente independentes, isto é, não sejam
ao longo do mesmo azimute (direção oposta do observador). Uma vez que os normais ou gradientes da superfície tenham sido recuperados em cada pixel, eles podem ser integrado em um mapa de profundidade usando uma variante de ajuste de superfície regularizado. 

Quando as superfícies são especulares, podem ser necessárias mais de três direções de luz. De fato,
a equação de irradiância dada na Figura~\ref{eq:irrad} não requer apenas que as fontes de luz e a câmera sejam
distante da superfície, mas também negligencia as inter-reflexões, que podem ser uma fonte significativa
do sombreamento observado nas superfícies dos objetos, por exemplo, o escurecimento visto dentro das estruturas côncavas como ranhuras e fendas.

\subsection{Formas a partir da textura}

A variação no escorço observado em texturas regulares também pode fornecer informações úteis sobre a orientação da superfície local. Na Figura\ref{fig:textura} temos um exemplo desse padrão, ao longo
com as orientações de superfície locais estimadas. Algoritmos de formas a partir de textura requerem um número
etapas de processamento, incluindo a extração de padrões repetidos ou a medição de frequências para calcular deformações afins locais, e um estágio subsequente para inferir orientação de superfície.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.9\textwidth]{imagem2.jpg}
    \caption{Forma sintética a partir da textura (Garding 1992)}
    \label{fig:textura}
\end{figure}


Quando o padrão original é regular, é possível ajustar um padrão regular, mas ligeiramente deformado, e usar essa grade para uma variedade de tarefas de substituição ou análise de imagens. Este processo torna-se ainda
mais fácil se padrões de tecido texturizado especialmente impressos forem usados. As deformações induzidas em um padrão regular, quando vistas na reflexão de um espelho curvo, como mostrado na Figura~\ref{fig:textura}, podem ser utilizadas para a recuperação da forma da superfície. Também é possível inferir informações de formas locais a partir do fluxo especular, ou seja, o movimento de especularidades quando visto de uma câmera em movimento.

\subsection{Formas a partir do foco}


Uma boa dica sobre a profundidade de um objeto é a quantidade de desfoque, que aumenta à medida que a superfície do objeto se afasta da distância de focagem da câmera. Movendo-se a superfície de um objeto para longe do plano de foco, aumentamos assim o círculo de confusão, quando calculado a partir de uma fórmula,podemos estabelecer esta característica facilmente.

Várias técnicas foram desenvolvidas para estimar a profundidade a partir da quantidade de desfocagem (profundidade de desfocagem) (Pentland 1987; Nayar and Nakagawa 1994; Nayar, Watanabe,
and Noguchi 1996; Watanabe and Nayar 1998; Chaudhuri and Rajagopalan 1999; Favaro
and Soatto 2006). Mas para que estas técnicas sejam efetivas é necessário levar em conta os seguintes problemas: 

\begin{enumerate}
    \item A quantidade de desfoque aumenta em ambas as direções à medida que você se afasta do plano de foco. Portanto, é necessário usar duas ou mais imagens capturadas com diferentes configurações de distância de foco, ou realizar a transformação das profundidades do objeto e analisar o ponto de nitidez máxima.
    \item A ampliação do objeto pode variar conforme a distância do foco é alterada ou o objeto é movido. Isso pode ser modelado explicitamente (tornando a correspondência mais difícil) ou a partir do uso da óptica telecêntrica, que aproxima uma câmera ortográfica e requer uma abertura na frente da lente.
    \item A quantidade de desfocagem deve ser estimada de maneira confiável. Uma abordagem simples é calcular a média quadrada do gradiente em uma região, mas tal abordagem pode sofrer de vários problemas, incluindo o problema de ampliação da imagem mencionado acima. Uma solução melhor é utilização de filtros racionais.

\end{enumerate}




\section{Detecção de profundidade usando sensores ativos}

bla bla bla

\section{Representação de superfícies}

Nesta seção vamos analisar as representações com mais detalhe. Representações explícitas de superfície, como malhas triangulares, \textit{splines} (Farin 1992, 1996) e superfícies de subdivisão (Stollnitz, DeRose, and Salesin 1996; Zorin, Schröder, and Sweldens 1996; Warren and Weimer 2001; Peters and Reif 2008), permitindo não apenas a criação de modelos altamento detalhados, mas também operações de processamento, como a interpolação (Seção \ref{subsec:InterpolacaoDeSuperficie}), carenagem ou suavização, dizimação e simplificação (Seção \ref{subsec:SimplificacaoDeSuperficie}).

\subsection{Interpolação de superfície}
\label{subsec:InterpolacaoDeSuperficie}

Uma das operações mais comuns em superfícies é a sua reconstrução a partir de um conjunto de restrições de dados esparsos, ou seja, interpolação de dados dispersos. Ao formular tais problemas, as superfícies podem ser parametrizadas como campos de altura $\[f(\textbf{x})\]$, como superfícies paramétricas 3D $\[\textbf{f}(\textbf{x})\]$, ou como modelos não paramétricos, como coleções de triângulos.

Sabemos que os problemas de interpolação de função bidimensional e de aproximação $\[d_i \rightarrow f(x)\]$ poderiam ser lançados como problemas de minimização de energia usando a regularização. Tais problemas também podem especificar os locais de descontinuidades na superfície, bem como as restrições de orientação local (Terzopoulos 1986b; Zhang, Dugas-Phocion, Samson et al. 2002).

Uma abordagem para resolver esses problemas é a discretização da superfície e da energia em uma malha ou malha discreta usando análise de elementos finitos (Terzopoulos, 1986b). Tais problemas podem então ser resolvidos usando técnicas esparsas de solução de sistemas, como o multigrid (Briggs, Henson e McCormick 2000) ou gradiente de conjugado hierarquicamente pré-condicionado (Szeliski 2006b). A superfície também pode ser representada usando uma combinação hierárquica de B-splines multiníveis (Lee, Wolberg e Shin 1996).

Uma abordagem alternativa é usar funções de base radial (\textit{kernel}) (Boult e Kender, 1986; Nielson, 1993) para interpolar um campo $\[f(x)\]$ até um número de valores de dados $\[d_i\]$ localizado em $\[x_i\]$, a abordagem da função de base radial usa a fórmula presenta na Figura \ref{fig:baseRadial}. Onde os pesos (Figura \ref{fig:calduloPeso}), são calculados usando uma função de base radial (esférica simétrica) K(r).

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.3\textwidth]{radialBasisFunction.jpg}
    \caption{Função de base radial (Boult e Kender, 1986; Nielson, 1993)}
    \label{fig:baseRadial}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.4\textwidth]{weightCalcule.jpg}
    \caption{Calculo do peso}
    \label{fig:calduloPeso}
\end{figure}

Se quisermos que a função $\[f(x)\]$ interpole exatamente os pontos de dados, as funções do kernel devem ser singulares na origem, $\lim_{r\to0}$ $K(r)\rightarrow\infty$(Nielson 1993), ou um sistema linear denso deve ser resolvido para determinar a magnitude associada a cada função de base (Boult e Kender 1986). Acontece que, para certos problemas regularizados, existem funções de base radial (\textit{kernels}) que dão os mesmos resultados que uma solução analítica completa (Boult e Kender 1986). Infelizmente, porque a solução densa do sistema é cúbica no número de pontos de dados, abordagens de função de base só podem ser usadas para pequenos problemas (Beier e Neely, 1992).

Quando uma superfície paramétrica tridimensional está sendo modelada, a função com valor de vetor $\[\textbf{f}\]$ (Figura \ref{fig:baseRadial}) codifica as coordenadas 3D \textit{(x, y, z)} na superfície e o domínio x = \textit{(s, t)} codifica a parametrização da superfície. Um exemplo destas superfícies são modelos paramétricos em busca de simetria, que são versões deformáveis elasticamente de cilindros generalizados (Terzopoulos, Witkin e Kass, 1987). Nestes modelos, \textit{s} é o parâmetro ao longo da espinha do tubo deformável e \textit{t} é o parâmetro em torno do tubo. Uma variedade de suavidade e forças de simetria radial são usadas para restringir o modelo enquanto ele é ajustado para curvas de silhueta baseadas em imagem.

Também é possível definir modelos de superfícies não paramétricas, como malhas trianguladas gerais, e equipar tais malhas com métricas internas de suavidade e métricas de ajuste de dados externos (Sander e Zucker, 1990; Fua e Sander, 1992; Delingette, Hebert e Ikeuichi 1992; McInerney e Terzopoulos 1993). Enquanto a maioria dessas abordagens assume um modelo padrão de deformação elástica, que usa termos de suavidade interna quadrática, também é possível usar modelos de energia sub-linear para preservar melhor os vincos superficiais (Diebel, Thrun e Brünig 2006). As malhas triangulares também podem ser aumentadas com elementos \textit{spline} (Sullivan e Ponce, 1998) ou superfícies subdivididas (Stollnitz, DeRose e Salesin, 1996; Zorin, Schröder e Sweldens, 1996; Warren e Weimer, 2001; Peters e Reif, 2008) para produzir superfícies com melhor controle de suavidade.

Os modelos de superfície paramétricos e não paramétricos assumem que a topologia da superfície é conhecida e fixada antecipadamente. Para modelagem de superfície mais flexível, podemos representar a superfície como uma coleção de pontos orientados ou usar funções implícitas 3D, que também podem ser combinadas com modelos de superfície 3D elásticos (McInerney e Terzopoulos 1993).

\subsection{Simplificação de superfície}
\label{subsec:SimplificacaoDeSuperficie}

Uma vez que uma malha triangular tenha sido criada a partir de dados 3D, muitas vezes é desejável criar uma hierarquia de modelos de malha, por exemplo, para controlar o nível de detalhe (\textit{level of detail}) exibido em um aplicativo de computação gráfica.

Uma maneira para se fazer isso é aproximar uma dada malha com uma que tenha conectividade de subdivisão, sobre a qual um conjunto de coeficientes triangulares \textit{wavelet} pode então ser computado (Eck, DeRose, Duchamp et al. 1995). Uma abordagem mais contínua é usar operações sequenciais de colapso de borda para ir da malha de resolução fina original para uma malha de nível básico grosseira (Hoppe 1996).

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{malhaProgressiva.png}
    \caption{Representação de malha progressiva de um modelo de avião (Hoppe 1996)}
    \label{fig:malhaProgressiva}
\end{figure}

A representação resultante da malha progressiva pode ser usada para renderizar o modelo 3D em níveis arbitrários de detalhe, como mostrado na Figura \ref{fig:malhaProgressiva}.

Na Figura \ref{fig:malhaProgressiva}a foi utilizado uma malha de base $\[\textit{M}^{0}\]$ (total de 150 faces), na sequência (\ref{fig:malhaProgressiva}b) a malha de base foi de $\[\textit{M}^{175}\]$ (totalizando 500 faces), a terceira (\ref{fig:malhaProgressiva}c) malha de base foi de $\[\textit{M}^{425}\]$ (1000 faces) e por último (\ref{fig:malhaProgressiva}d) uma malha de base original $\[\textit{M = M}^n\]$, sendo esta totalizando 13,546 faces.

\subsection{Imagens de geometria}

Enquanto representações de superfície de multi-resolução suportam operações de nível de detalhes, elas ainda consistem em uma coleção irregular de triângulos, o que dificulta comprimir e armazenar em cache de maneira eficiente.

Para tornar a triangulação completamente regular (uniforme e quadriculado), Gu, Gortler e Hoppe (2002) descrevem como criar imagens geométricas cortando malhas de superfície ao longo de linhas bem escolhidas e “achatando” a representação resultante em um quadrado.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{imagemDeGeometria.jpg}
    \caption{Imagens de geometria (Gu, Gortler e Hoppe 2002) ACM: (a) 257x257 imagem de geometria define uma malha sobre a superfície; (b) mapa normal de 512 × 512 que define o vértice normal; (c) modelo 3D final iluminado.}
    \label{fig:imagemGeometria}
\end{figure}

A Figura \ref{fig:imagemGeometria}a mostra os valores resultantes \textit{(x, y, z)} da malha de superfície mapeada sobre o quadrado unitário, enquanto a Figura \ref{fig:imagemGeometria}b mostra o mapa normal associado \textit{(nx, ny, nz)}, ou seja, as normais de superfície associadas a cada malha vértice, que pode ser usado para compensar a perda de fidelidade visual se a imagem da geometria original estiver muito comprimida.

\section{Reconstrução baseada em modelos}

bla bla bla

% References
\small
\bibliographystyle{plain}
\bibliography{bibliography}
\end{document}


